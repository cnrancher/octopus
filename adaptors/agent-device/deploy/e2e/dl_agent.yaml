apiVersion: edge.cattle.io/v1alpha1
kind: DeviceLink
metadata:
  name: logging-devices
spec:
  adaptor:
    node: edge-worker
    name: adaptors.edge.cattle.io/agent-device
  model:
    apiVersion: "devices.edge.cattle.io/v1alpha1"
    kind: "AgentDeviceGroup"
  template:
    metadata:
      labels:
        device: ip-172-31-31-2
    spec:
      apps:
        - name: fluentd
          namespace: default
          template:
            metadata:
              labels:
                device: ip-172-31-31-2
            spec:
              tolerations:
                # this toleration is to have the daemonset runnable on master nodes
                # remove it if your masters can't run pods
                - key: node-role.kubernetes.io/master
                  effect: NoSchedule
              containers:
                - name: fluentd-elasticsearch
                  image: quay.io/fluentd_elasticsearch/fluentd:v2.5.2
                  resources:
                    limits:
                      memory: 200Mi
                    requests:
                      cpu: 100m
                      memory: 200Mi
                  volumeMounts:
                    - name: varlog
                      mountPath: /var/log
                    - name: varlibdockercontainers
                      mountPath: /var/lib/docker/containers
                      readOnly: true
              terminationGracePeriodSeconds: 30
              volumes:
                - name: varlog
                  hostPath:
                    path: /var/log
                - name: varlibdockercontainers
                  hostPath:
                    path: /var/lib/docker/containers